{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://kiro.dev/schemas/question-bank.json",
  "title": "Kiro Question Bank Schema",
  "description": "Schema for Kiro Language Learning Question Bank items with open source attribution",
  "version": "1.0.0",
  
  "definitions": {
    "language": {
      "type": "string",
      "enum": ["EN", "JP", "TH"],
      "description": "ISO language code"
    },
    
    "questionType": {
      "type": "string",
      "enum": ["vocab", "grammar", "reading", "listening", "pronunciation", "conversation"],
      "description": "Type of learning content"
    },
    
    "licenseType": {
      "type": "string",
      "enum": ["CC-BY", "CC-BY-SA", "EDRDG", "Public-Domain", "Other"],
      "description": "License type for content attribution"
    },
    
    "levelClassification": {
      "type": "object",
      "properties": {
        "system": {
          "type": "string",
          "enum": ["CEFR", "JLPT", "heuristic"]
        },
        "level": {
          "type": "string",
          "description": "Level within the classification system"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence score for heuristic classifications"
        }
      },
      "required": ["system", "level"],
      "additionalProperties": false
    },
    
    "source": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique source identifier"
        },
        "name": {
          "type": "string",
          "description": "Human-readable source name"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Source URL if available"
        },
        "license": {
          "$ref": "#/definitions/licenseType"
        },
        "attribution": {
          "type": "string",
          "description": "Required attribution text"
        },
        "version": {
          "type": "string",
          "description": "Source version or date"
        },
        "lastUpdated": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp"
        },
        "description": {
          "type": "string",
          "description": "Source description"
        }
      },
      "required": ["id", "name", "license", "attribution"],
      "additionalProperties": false
    },
    
    "mediaItem": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["audio", "image", "video"]
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "mimeType": {
          "type": "string"
        },
        "size": {
          "type": "integer",
          "minimum": 0
        },
        "duration": {
          "type": "number",
          "minimum": 0,
          "description": "Duration in seconds for audio/video"
        },
        "license": {
          "$ref": "#/definitions/licenseType"
        },
        "attribution": {
          "type": "string"
        },
        "alt": {
          "type": "string",
          "description": "Alt text for accessibility"
        }
      },
      "required": ["id", "type", "url", "mimeType", "license", "attribution"],
      "additionalProperties": false
    },
    
    "difficultyMetrics": {
      "type": "object",
      "properties": {
        "wordFrequency": {
          "type": "number",
          "minimum": 1,
          "description": "Word frequency rank (1 = most common)"
        },
        "sentenceLength": {
          "type": "integer",
          "minimum": 0,
          "description": "Character count"
        },
        "grammarComplexity": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Grammar complexity score"
        },
        "kanjiCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of kanji characters (Japanese only)"
        },
        "vocabularyLevel": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Vocabulary difficulty level"
        },
        "overallScore": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "Computed overall difficulty score"
        }
      },
      "required": ["overallScore"],
      "additionalProperties": false
    }
  },
  
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique item identifier"
    },
    "version": {
      "type": "string",
      "description": "Item version for change tracking"
    },
    "language": {
      "$ref": "#/definitions/language"
    },
    "type": {
      "$ref": "#/definitions/questionType"
    },
    "prompt": {
      "type": "string",
      "minLength": 1,
      "description": "Question or prompt text"
    },
    "choices": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 2,
      "maxItems": 6,
      "description": "Multiple choice options (if applicable)"
    },
    "answer": {
      "oneOf": [
        {
          "type": "string",
          "description": "Text answer"
        },
        {
          "type": "integer",
          "minimum": 0,
          "description": "Choice index for MCQ"
        },
        {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Multiple acceptable answers"
        }
      ]
    },
    "explanation": {
      "type": "string",
      "description": "Answer explanation or learning note"
    },
    "level": {
      "$ref": "#/definitions/levelClassification"
    },
    "difficulty": {
      "$ref": "#/definitions/difficultyMetrics"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-z0-9-]+$"
      },
      "uniqueItems": true,
      "description": "Content tags for organization and search"
    },
    "source": {
      "$ref": "#/definitions/source"
    },
    "media": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/mediaItem"
      },
      "description": "Associated media files"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time"
    },
    "reviewedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Last quality review date"
    },
    "reviewedBy": {
      "type": "string",
      "description": "Reviewer identifier"
    },
    "usageCount": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of times this item has been used"
    },
    "successRate": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Success rate (0-1) from user interactions"
    },
    "averageTime": {
      "type": "number",
      "minimum": 0,
      "description": "Average time to answer in seconds"
    }
  },
  
  "required": [
    "id",
    "version",
    "language",
    "type",
    "prompt",
    "answer",
    "level",
    "difficulty",
    "tags",
    "source",
    "createdAt",
    "updatedAt"
  ],
  
  "additionalProperties": false,
  
  "examples": [
    {
      "id": "en-vocab-business-001",
      "version": "1.0.0",
      "language": "EN",
      "type": "vocab",
      "prompt": "What does 'negotiate' mean in a business context?",
      "choices": [
        "To argue aggressively",
        "To discuss terms to reach an agreement",
        "To refuse a proposal",
        "To delay a decision"
      ],
      "answer": 1,
      "explanation": "Negotiate means to discuss something with someone in order to reach an agreement, especially in business dealings.",
      "level": {
        "system": "CEFR",
        "level": "B1"
      },
      "difficulty": {
        "wordFrequency": 2500,
        "sentenceLength": 45,
        "grammarComplexity": 4,
        "vocabularyLevel": 6,
        "overallScore": 65
      },
      "tags": ["business", "vocabulary", "workplace", "communication"],
      "source": {
        "id": "ngsl-2024",
        "name": "New General Service List",
        "url": "https://www.newgeneralservicelist.org/",
        "license": "CC-BY",
        "attribution": "New General Service List (NGSL) by Dr. Charles Browne et al.",
        "version": "2024.1",
        "description": "High-frequency English vocabulary list"
      },
      "createdAt": "2024-08-15T10:00:00Z",
      "updatedAt": "2024-08-15T10:00:00Z"
    },
    {
      "id": "jp-grammar-particles-001",
      "version": "1.0.0",
      "language": "JP",
      "type": "grammar",
      "prompt": "私___学校___行きます。(I go to school)",
      "choices": ["は、に", "が、を", "は、を", "を、に"],
      "answer": 0,
      "explanation": "は marks the topic (私は) and に indicates direction/destination (学校に)",
      "level": {
        "system": "JLPT",
        "level": "N5"
      },
      "difficulty": {
        "kanjiCount": 2,
        "grammarComplexity": 3,
        "vocabularyLevel": 2,
        "overallScore": 25
      },
      "tags": ["particles", "grammar", "basic", "direction"],
      "source": {
        "id": "jmdict-2024",
        "name": "JMdict Japanese-English Dictionary",
        "url": "https://www.edrdg.org/jmdict/j_jmdict.html",
        "license": "EDRDG",
        "attribution": "JMdict by Electronic Dictionary Research and Development Group",
        "version": "2024.08",
        "description": "Japanese-English dictionary database"
      },
      "createdAt": "2024-08-15T10:00:00Z",
      "updatedAt": "2024-08-15T10:00:00Z"
    }
  ]
}